<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betting Parser (Final WhatsApp Fix)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background: #f0f2f5; color: #333; }
        .container { max-width: 1100px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        h2 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        textarea { 
            width: 100%; height: 200px; padding: 15px; border: 1px solid #ddd; 
            border-radius: 8px; font-family: 'Consolas', monospace; font-size: 13px; 
            background-color: #fafafa; box-sizing: border-box; 
        }
        textarea:focus { outline: none; border-color: #007bff; background: #fff; }
        
        .controls { margin-top: 15px; display: flex; gap: 10px; margin-bottom: 20px; }
        button { background-color: #007bff; color: white; border: none; padding: 12px 25px; font-size: 16px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: background 0.2s; }
        button:hover { background-color: #0056b3; }
        button.clear { background-color: #6c757d; }
        
        /* Table Styles */
        .table-container { overflow-x: auto; margin-bottom: 20px; border: 1px solid #eee; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { background-color: #f8f9fa; text-align: left; padding: 12px; font-weight: 600; border-bottom: 2px solid #ddd; }
        td { padding: 10px 12px; border-bottom: 1px solid #eee; vertical-align: top; }
        tr:hover { background-color: #f9f9f9; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; color: white; background: #6c757d; display: inline-block; }
        .badge.AKAR { background: #17a2b8; }
        .badge.JODI { background: #28a745; }
        .badge.PATTI { background: #fd7e14; }
        .badge.FULLFAMILY { background: #6f42c1; }
        .badge.SPMOTOR { background: #e83e8c; }
        
        .raw-text { color: #888; font-style: italic; font-size: 0.9em; font-family: monospace; }
        .amount { font-weight: bold; color: #d63384; }
        
        #jsonOutput { background: #1e1e1e; color: #a9b7c6; padding: 20px; border-radius: 8px; font-family: 'Consolas', monospace; white-space: pre-wrap; font-size: 13px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="container">
    <h2>Betting Input Parser</h2>
    
    <textarea id="inputArea">
[19/11, 5:14 pm] Lain: 119*678*390*589*889*170*370*200*347*779+5
[19/11, 5:14 pm] Lain: 1=6=750
2=9=1500
0=8=700
4=7=600
[6:41 pm, 1/11/2025] +91 90248 33348: 4.5.6.7.......750
Madur night fm = 6.2.1.9.8.3..5 700me 
279=249=100rme=female
</textarea>
    
    <div class="controls">
        <button onclick="processBets()">Parse Data</button>
        <button class="clear" onclick="document.getElementById('inputArea').value=''">Clear Input</button>
    </div>

    <div id="tableContainer" class="table-container"></div>
    <h3>JSON Structure</h3>
    <div id="jsonOutput">JSON results will appear here...</div>
</div>

<script>
    // 1. CONFIGURATION
    const TYPE_DEFINITIONS = {
        'FULLFAMILY': ['f', 'family', 'fullfamily', 'fm', 'set', 'cut', 'female', 'femely', 'femeli', 'फेमली', 'फेमिली'],
        'HALFFAMILY': ['hf', 'halffamily'],
        'JODIFAMILY': ['jf', 'jodifamily'],
        'SPMOTOR':    ['m', 'mtr', 'spmtr', 'spm', 'spmotor', 'spmothr'],
        'DPMOTOR':    ['dpm', 'dpmtr', 'dpmotor', 'dpmothr'],
        'SPDPMOTOR':  ['spdpm', 'spdpmotor'],
        'DP':         ['dp', 'dppane'],
        'SP':         ['sp', 'sppane'],
        'SPDP':       ['sdp'],
        'TRIAL':      ['t', 'trial'],
        'SR':         ['sr', 'series', 'dhar', 'sirij'],
        'SRFAMILY':   ['srf'],
        'SRR':        ['srr'],
        'JODICOMBINATION': ['jc', 'jodicombination'],
        'JODICOMBINATIONREPEAT': ['jfr', 'jodicombinationrepeat'],
        'AKAR':       ['a', 'akar', 'aakda', 'akr'],
        'JODI':       ['j', 'jodi'],
        'PATTI':      ['p', 'pati', 'patti', 'pana', 'pt'],
    };

    let aliasMap = {};
    for (const [type, aliases] of Object.entries(TYPE_DEFINITIONS)) {
        aliases.forEach(alias => {
            aliasMap[alias] = type;
        });
    }

    function processBets() {
        const rawInput = document.getElementById('inputArea').value;
        const lines = rawInput.split('\n');
        const validBets = [];

        lines.forEach((line) => {
            let originalLine = line; 
            line = line.trim();
            if (!line) return;

            // --- STEP 0: CLEAN WHATSAPP METADATA (IMPROVED) ---
            // Old Logic: looked for digits after bracket
            // New Logic: Removes "[...anything...] ...anything... :"
            // It matches from start of line ^ up to the first colon :
            
            line = line.replace(/^\[.*?\][^:]*:/, '').trim();

            if (!line) return;

            // --- STEP 1: EXTRACT NUMBERS ---
            let numbers = line.match(/\d+/g);

            if (!numbers || numbers.length < 2) {
                return; 
            }

            // --- STEP 2: IDENTIFY AMOUNT ---
            const amount = numbers.pop(); 

            // --- STEP 3: IDENTIFY TYPE ---
            let type = null;
            const textParts = line.match(/[a-zA-Z\u0900-\u097F]+/g); 

            if (textParts) {
                for (let part of textParts) {
                    let cleanPart = part.toLowerCase();
                    if (aliasMap[cleanPart]) {
                        type = aliasMap[cleanPart];
                        break; 
                    }
                }
            }

            // --- STEP 4: FALLBACK TYPE (Number Length) ---
            if (!type && numbers.length > 0) {
                const firstNumLen = numbers[0].length;
                switch (firstNumLen) {
                    case 1: type = 'AKAR'; break; 
                    case 2: type = 'JODI'; break; 
                    case 3: type = 'PATTI'; break; 
                    default: type = 'UNKNOWN_LEN_' + firstNumLen;
                }
            }

            // Save Data
            if (numbers.length > 0) {
                validBets.push({
                    numbers: numbers,
                    type: type,
                    amount: amount,
                    original: originalLine
                });
            }
        });

        renderTable(validBets);
        renderJson(validBets);
    }

    function renderTable(bets) {
        const container = document.getElementById('tableContainer');
        if (bets.length === 0) {
            container.innerHTML = "<p style='padding:15px; text-align:center'>No valid bets found.</p>";
            return;
        }

        let html = `<table>
            <thead>
                <tr>
                    <th style="width: 40%">Numbers</th>
                    <th style="width: 20%">Type</th>
                    <th style="width: 10%">Amount</th>
                    <th style="width: 30%">Raw Line</th>
                </tr>
            </thead>
            <tbody>`;

        bets.forEach(bet => {
            html += `<tr>
                <td>${bet.numbers.join(', ')}</td>
                <td><span class="badge ${bet.type}">${bet.type}</span></td>
                <td class="amount">${bet.amount}</td>
                <td class="raw-text">${bet.original.substring(0, 50)}${bet.original.length > 50 ? '...' : ''}</td>
            </tr>`;
        });

        html += `</tbody></table>`;
        container.innerHTML = html;
    }

    function renderJson(bets) {
        const jsonDiv = document.getElementById('jsonOutput');
        if (bets.length === 0) {
            jsonDiv.innerText = "No data.";
        } else {
            const cleanBets = bets.map(({original, ...keepAttrs}) => keepAttrs);
            jsonDiv.innerText = JSON.stringify(cleanBets, null, 4);
        }
    }
</script>

</body>
</html>
